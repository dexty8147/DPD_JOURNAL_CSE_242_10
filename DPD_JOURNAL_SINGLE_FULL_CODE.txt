<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPD JOURNALS - Professional E-commerce</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            
            --primary-color: #0066cc; 
            --accent-color: #ffaa00; 
            --header-bg: #111827; 
            --success-color: #10b981;
            --danger-color: #ef4444; 
            --light-bg: #f9fafb; 
            --card-bg: #ffffff;
            --dark-text: #1f2937;
            --secondary-text: #6b7280;
            --border-color: #e5e7eb;
            --radius-md: 6px;
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
        }

        h1, h2, h3 {
            color: var(--dark-text);
            font-weight: 600;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); 
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo-area {
            text-align: left;
        }
        .logo-area h1 {
            font-size: 2.2em;
            margin: 0;
            color: white;
            letter-spacing: 1px;
        }
        .logo-area p {
            margin: 5px 0 0 0;
            font-size: 0.85em;
            color: #d1d5db;
        }

        #location-selector-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #d1d5db;
        }

        #location-selector-header select {
            padding: 5px 10px;
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
            cursor: pointer;
            outline: none;
            appearance: none; 
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M287%2069.4L146.2%20208.7L5.4%2069.4h281.6z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 8px top 50%;
            background-size: 0.65em auto;
        }
        #location-selector-header select option {
             color: black; 
             background-color: white;
        }


        nav {
            background-color: var(--primary-color);
            padding: 10px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            margin: 0 5px;
            font-weight: 500;
            transition: background-color 0.3s, border-radius 0.3s;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            border-bottom-color: var(--accent-color);
        }
        
        #cart-count-badge {
            background-color: var(--accent-color);
            color: var(--dark-text);
            padding: 2px 6px;
            border-radius: 9999px;
            font-size: 0.75em;
            font-weight: 700;
            margin-left: 5px;
        }


        .container {
            width: 95%;
            max-width: 1200px;
            margin: 30px auto;
            padding: 25px;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); 
        }
        
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }

        h2 {
            padding-bottom: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            font-size: 1.8em;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: var(--radius-md);
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            text-transform: uppercase;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .btn:hover {
            background-color: #005bb5;
            transform: translateY(-1px);
        }
        
        .add-to-cart {
            background-color: var(--accent-color);
            color: var(--dark-text);
        }
        .add-to-cart:hover {
            background-color: #e69500;
        }

        .btn-success {
            background-color: var(--success-color);
        }
        .btn-success:hover {
            background-color: #0d9488;
        }
        
        input[type="text"], input[type="email"], input[type="tel"], textarea, select, .qty-input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-sizing: border-box;
            background-color: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-size: 1em;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2);
        }
        
        .qty-input {
            width: 70px; 
            text-align: center;
            display: inline-block;
        }

        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
        }

        .product-card {
            padding: 20px;
            border-radius: var(--radius-md);
            text-align: center;
            background-color: var(--card-bg);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05); 
            transition: box-shadow 0.2s, transform 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .product-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            transform: translateY(-3px);
        }

        .product-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.15em;
            min-height: 50px;
            color: var(--primary-color);
        }

        .price {
            font-size: 1.8em;
            color: var(--dark-text);
            font-weight: 700;
            margin: 15px 0;
        }
        
        .price::before {
            content: "Price: ";
            font-size: 0.6em;
            color: var(--secondary-text);
            font-weight: 400;
        }

        #cart-content {
            background-color: #fff;
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: var(--radius-md);
        }

        #cart-items {
            list-style: none;
            padding: 0;
        }

        #cart-items li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 1.05em;
        }
        #cart-items li:last-child {
            border-bottom: none;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .remove-item, .qty-update {
            cursor: pointer;
            font-weight: bold;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .remove-item { color: var(--danger-color); font-size: 0.9em; }
        .qty-update { color: var(--primary-color); }
        .remove-item:hover { background-color: #fee2e2; }
        .qty-update:hover { background-color: #eff6ff; }
        
        #cart-summary {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 20px;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px dashed var(--border-color);
        }
        #cart-summary p {
            font-size: 1.5em;
            font-weight: 700;
        }

        #checkout-page {
            max-width: 800px;
            margin: auto;
        }
        
        #payment-section {
            border: 2px dashed var(--accent-color);
            padding: 25px;
            border-radius: var(--radius-md);
            margin-top: 30px;
            background-color: #fffbeb; 
        }

        .payment-option {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: white;
        }
        .payment-option:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }
        
        .payment-option input[type="radio"]:checked + label {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .payment-details {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #ffcc80;
            border-radius: var(--radius-md);
            background-color: #fff8e1;
        }

        .review-card {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: var(--radius-md);
            background-color: var(--card-bg);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-color);
        }
        .review-card p {
            margin: 5px 0;
            color: var(--secondary-text);
        }
        .rating {
            color: #fbbf24; 
            font-size: 1.1em;
            font-weight: 700;
        }

        .error-message {
            color: var(--danger-color);
            font-weight: 600;
            margin-top: 15px;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div class="logo-area">
                <h1>DPD JOURNALS</h1>
                <p>Driving Research, Inspiring Innovation</p>
            </div>
            
            <div id="location-selector-header">
                <span>üìç Currency:</span>
                <select id="location" onchange="updateProductPrices()">
                    <option value="india">India (INR ‚Çπ)</option>
                    <option value="usa">USA (USD $)</option>
                    <option value="europe">Europe (EUR ‚Ç¨)</option>
                    <option value="rest">Rest of the World (USD $)</option>
                </select>
            </div>
        </div>
    </header>

    <nav id="main-nav">
        <a href="#home" onclick="showPage('home')" id="nav-home" class="active">HOME</a>
        <a href="#cart" onclick="showPage('cart')" id="nav-cart">CART <span id="cart-count-badge">0</span></a>
        <a href="#about" onclick="showPage('about')" id="nav-about">ABOUT US</a>
        <a href="#reviews" onclick="showPage('reviews')" id="nav-reviews">REVIEWS</a>
    </nav>

    <div class="container" id="app-container">

        <section id="home-page" class="page-section active">
            <h2>üìö Today's Best Selling Journals</h2>

            <p style="color: var(--secondary-text); margin-bottom: 20px;">Prices are displayed based on the currency selected in the header.</p>

            <div class="product-list" id="product-list">
                </div>
        </section>

        <section id="cart-page" class="page-section">
            <h2>üõí Your Shopping Cart</h2>
            <div id="cart-content">
                <ul id="cart-items">
                    </ul>
                <div id="cart-summary">
                    <p>Total: <span id="cart-total">‚Çπ0.00</span></p>
                    <button class="btn btn-success" onclick="showPage('checkout')">Proceed to Checkout</button>
                    <button class="btn" onclick="showPage('home')" style="background-color: var(--secondary-text);">Continue Shopping</button>
                </div>
            </div>
        </section>
        
        <section id="checkout-page" class="page-section">
            <h2>üí≥ Finalize Order Details</h2>

            <form id="checkout-form" class="checkout-form">
                <h3 style="border-bottom: 1px dashed var(--border-color); padding-bottom: 10px;">Delivery Address</h3>
                <label for="name">Full Name:</label>
                <input type="text" id="name" required>

                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" pattern="[0-9]{10,}" title="Minimum 10 digits" required>

                <label for="email">Email ID:</label>
                <input type="email" id="email" required>

                <label for="address">Full Address:</label>
                <textarea id="address" rows="3" required></textarea>

                <label for="pincode">Pin Code:</label>
                <input type="text" id="pincode" pattern="[0-9]{4,8}" title="4 to 8 digits" required>

                <button type="submit" class="btn btn-success" id="select-payment-btn">Select Payment Mode</button>
            </form>

            <div id="payment-section" class="hidden">
                <h3 style="color: var(--primary-color);">Select Payment Mode (Pay: <span id="payment-total-display" style="color: var(--danger-color);">‚Çπ0.00</span>)</h3>
                
                <div class="payment-option" onclick="selectPayment('cod')">
                    <input type="radio" name="payment-mode" value="cod" id="cod" required>
                    <label for="cod">Cash on Delivery (COD)</label>
                </div>
                <div class="payment-option" onclick="selectPayment('upi')">
                    <input type="radio" name="payment-mode" value="upi" id="upi">
                    <label for="upi">UPI Pay (Fast & Secure)</label>
                    <div id="upi-details" class="payment-details hidden">
                        <label for="upi-id">Enter UPI ID (Dummy):</label>
                        <input type="text" id="upi-id" placeholder="e.g., username@bank" required>
                    </div>
                </div>
                <div class="payment-option" onclick="selectPayment('card')">
                    <input type="radio" name="payment-mode" value="card" id="card">
                    <label for="card">Pay by Credit/Debit Card</label>
                    <div id="card-details" class="payment-details hidden">
                        <label for="card-number">Card Number (Dummy):</label>
                        <input type="text" id="card-number" pattern="[0-9]{16}" title="16-digit number" required>
                        <label for="expiry">Expiry (MM/YY):</label>
                        <input type="text" id="expiry" pattern="(0[1-9]|1[0-2])\/[0-9]{2}" placeholder="MM/YY" required>
                        <label for="cvv">CVV (Dummy):</label>
                        <input type="text" id="cvv" pattern="[0-9]{3,4}" title="3 or 4 digits" required>
                    </div>
                </div>

                <div id="payment-error" class="error-message hidden"></div>
                <button class="btn add-to-cart" id="proceed-to-pay-btn" onclick="proceedToPay()" style="margin-top: 15px;">Proceed to Pay</button>
            </div>
        </section>

        <section id="about-page" class="page-section">
            <h2>üí° About DPD JOURNALS & Project Team</h2>
            <p><strong>DPD JOURNALS: Driving Research, Inspiring Innovation</strong></p>
            <p>DPD JOURNALS stands as a beacon of academic excellence and professional publishing, dedicated to disseminating cutting-edge research across diverse scientific, engineering, and humanities domains. Established with the core mission of bridging the gap between academic theory and real-world application, we publish a curated portfolio of peer-reviewed journals, monographs, and conference proceedings. Our editorial board comprises globally recognized experts, ensuring the highest standards of integrity, rigor, and scholarly significance in every published article. We believe that open access to knowledge is paramount for global progress, and our commitment extends to promoting diversity in authorship and subject matter. DPD JOURNALS acts as a critical platform for emerging scholars and seasoned researchers alike, fostering a collaborative environment where ideas are exchanged, challenged, and ultimately, transformed into impactful innovations. We cover everything from advanced material science and computational intelligence to contemporary social dynamics and digital media ethics.</p>

            <p>Our commitment to excellence goes beyond mere publication. We invest in advanced digital tools for rapid peer review, ethical content screening, and maximum discoverability. We are constantly evolving our publishing model to embrace new technologies, such as dynamic data presentation and integration with research data repositories, ensuring that our journals remain at the forefront of the scholarly communication landscape. By partnering with leading universities and research institutions, DPD JOURNALS continues to drive the global research agenda, making complex knowledge accessible and actionable for policymakers, educators, and industry professionals. The journal collection is meticulously organized to serve distinct communities, ensuring specialized relevance while maintaining an overarching commitment to interdisciplinary dialogue.</p>
            
            <h3 style="margin-top: 30px; color: var(--primary-color);">The CSE_242 Project: "DPD JOURNALS Web Application"</h3>
            <p>This educational web application project was conceptualized and developed by Team **CSE_242** as a demonstration of front-end development capabilities (HTML, CSS, and JavaScript) to create a complex e-commerce simulation. The primary goal was to implement dynamic features like location-based pricing, a fully functional shopping cart, a multi-step checkout process with dummy payment handling, and on-the-fly invoice generation, all without reliance on a traditional backend server or database.</p>
            
            <p>The team members leveraged various technologies, including modern JavaScript for state management (cart and pricing logic) and the **jsPDF** library for client-side PDF invoice creation. The project emphasizes clean code, user experience, and adherence to modern web standards, simulating the key transactional and informational elements of a real-world publishing portal.</p>
            
            <h4 style="margin-top: 20px;">Team Members:</h4>
            <ul style="list-style: disc; margin-left: 20px; color: var(--secondary-text);">
                <li>**PIRUTHIVI RAJ SARAVANAN** (ID: 20221CSE0268, Email: PIRUTHIVI.20221CSE0268)</li>
                <li>**VANKA REVANTH ADITHYA** (ID: 20221CSE0260, Email: VANKA.20221CSE0260@presidencyuniversity.in)</li>
                <li>**RAFAEL V** (ID: 20221CSE0270, Email: RAFAEL.20221CSE0270)</li>
            </ul>
        </section>

        <section id="reviews-page" class="page-section">
            <h2>‚≠ê Customer Reviews</h2>
            <div id="existing-reviews">
                <h3 style="color: var(--primary-color);">What Our Readers Say:</h3>
                </div>

            <hr style="border-top: 1px solid var(--border-color); margin: 30px 0;">

            <h3>Submit Your Review & Rating:</h3>
            <form id="new-review-form">
                <label for="review-name">Your Name:</label>
                <input type="text" id="review-name" required>

                <label for="review-rating">Rating (1 to 5):</label>
                <select id="review-rating" required>
                    <option value="">-- Select Rating --</option>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Excellent)</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (Good)</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê (Average)</option>
                    <option value="2">‚≠ê‚≠ê (Poor)</option>
                    <option value="1">‚≠ê (Terrible)</option>
                </select>

                <label for="review-text">Your Review:</label>
                <textarea id="review-text" required></textarea>

                <button type="submit" class="btn">Post Review</button>
                <p id="review-message" class="error-message hidden"></p>
            </form>
        </section>

    </div>

    <script>

        const PRODUCTS = [
            { id: 1, name: "International Journal of Computational Science & Engineering", basePrice: 150, unit: 'Volume' },
            { id: 2, name: "Advanced Materials and Nano-Technologies Review", basePrice: 220, unit: 'Subscription' },
            { id: 3, name: "Journal of Sustainable Energy Systems", basePrice: 185, unit: 'Issue' },
            { id: 4, name: "DPD Review of Social Dynamics & Policy", basePrice: 120, unit: 'Copy' },
            { id: 5, name: "Global Business Management & Strategy", basePrice: 250, unit: 'Yearly Access' },
        ];

        const PRICE_MULTIPLIERS = {
            'india': { currency: '‚Çπ', symbol: '‚Çπ', multiplier: 1.0 },
            'usa': { currency: 'USD', symbol: '$', multiplier: 0.012 },
            'europe': { currency: 'EUR', symbol: '‚Ç¨', multiplier: 0.011 },
            'rest': { currency: 'USD', symbol: '$', multiplier: 0.015 },
        };

        let cart = [];
        let customerDetails = {}; 


        function showPage(pageId) {
            if (pageId === 'checkout' && cart.length === 0) {
                alert('Your cart is empty! Please add products before checking out.');
                return;
            }

            const pages = document.querySelectorAll('.page-section');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
            }

            const targetNav = document.getElementById('nav-' + pageId);
            if (targetNav) {
                targetNav.classList.add('active');
            }

            if (pageId === 'checkout') {
                document.getElementById('payment-total-display').textContent = document.getElementById('cart-total').textContent;
                document.getElementById('payment-section').classList.add('hidden');
                document.getElementById('select-payment-btn').classList.remove('hidden');
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }



        function renderProducts() {
            const listElement = document.getElementById('product-list');
            listElement.innerHTML = '';
            const locationKey = document.getElementById('location').value;
            const pricing = PRICE_MULTIPLIERS[locationKey];

            PRODUCTS.forEach(product => {
                const calculatedPrice = (product.basePrice * pricing.multiplier).toFixed(2);

                const productHTML = `
                    <div class="product-card">
                        <div>
                            <h3>${product.name}</h3>
                            <p style="font-size: 0.85em; color: var(--secondary-text);">${product.unit}</p>
                        </div>
                        <div style="margin-top: auto;">
                            <div class="price">${pricing.symbol}${calculatedPrice}</div>
                            <input type="number" id="qty-${product.id}" class="qty-input" value="1" min="1" max="10">
                            <button class="add-to-cart btn" onclick="addToCart(${product.id}, '${product.name}', ${calculatedPrice}, '${pricing.symbol}')">Add to Cart</button>
                        </div>
                    </div>
                `;
                listElement.insertAdjacentHTML('beforeend', productHTML);
            });
        }

        function updateProductPrices() {
            renderProducts();
            renderCart(); 
        }

        function addToCart(id, name, price, symbol) {
            const qtyInput = document.getElementById(`qty-${id}`);
            const quantity = parseInt(qtyInput.value);

            if (quantity > 10) {
                alert('Maximum order quantity per product is 10.');
                return;
            }

            const existingItem = cart.find(item => item.id === id);

            if (existingItem) {
                const newQuantity = existingItem.quantity + quantity;
                if (newQuantity > 10) {
                    alert(`Adding ${quantity} exceeds the maximum limit of 10. Current in cart: ${existingItem.quantity}`);
                    return;
                }
                existingItem.quantity = newQuantity;
            } else {
                cart.push({ id, name, price: parseFloat(price), quantity, symbol });
            }

            qtyInput.value = 1;
            renderCart();
        }

        function renderCart() {
            const cartItemsElement = document.getElementById('cart-items');
            const cartTotalElement = document.getElementById('cart-total');
            const cartCountBadge = document.getElementById('cart-count-badge');
            cartItemsElement.innerHTML = '';

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCountBadge.textContent = totalItems;

            if (cart.length === 0) {
                cartItemsElement.innerHTML = '<li style="justify-content: center; color: var(--secondary-text); font-style: italic;">Your cart is empty.</li>';
                cartTotalElement.textContent = '‚Çπ0.00';
                document.querySelector('#cart-page .btn-success').disabled = true;
                return;
            }

            let total = 0;
            let currentPricing = PRICE_MULTIPLIERS[document.getElementById('location').value];
            let symbol = currentPricing.symbol;
            
            const baseProducts = PRODUCTS.reduce((map, p) => {
                map[p.id] = p.basePrice;
                return map;
            }, {});

            const updatedCart = cart.map(item => {
                const basePrice = baseProducts[item.id];
                const newPrice = (basePrice * currentPricing.multiplier).toFixed(2);
                return { 
                    ...item, 
                    price: parseFloat(newPrice),
                    symbol: symbol
                };
            });
            cart = updatedCart; 

            cart.forEach(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;

                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span style="font-weight: 500; flex-grow: 1;">${item.name}</span>
                    <span class="cart-item-actions">
                        <span class="qty-update" onclick="updateQuantity(${item.id}, -1)">‚ûñ</span>
                        ${item.quantity} 
                        <span class="qty-update" onclick="updateQuantity(${item.id}, 1)">‚ûï</span>
                        <span style="min-width: 80px; text-align: right;">${item.symbol}${subtotal.toFixed(2)}</span>
                        <span class="remove-item" onclick="removeFromCart(${item.id})">Remove</span>
                    </span>
                `;
                cartItemsElement.appendChild(listItem);
            });

            cartTotalElement.textContent = `${symbol}${total.toFixed(2)}`;
            document.querySelector('#cart-page .btn-success').disabled = false;
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            renderCart();
        }

        function updateQuantity(id, change) {
            const item = cart.find(i => i.id === id);
            if (item) {
                const newQuantity = item.quantity + change;
                if (newQuantity < 1) {
                    removeFromCart(id);
                } else if (newQuantity > 10) {
                    alert('Maximum order quantity per product is 10.');
                } else {
                    item.quantity = newQuantity;
                    renderCart();
                }
            }
        }
        

        function handleCheckoutSubmit(e) {
            e.preventDefault();
            
            if (document.getElementById('checkout-form').checkValidity() === false) {
                 return;
            }

            customerDetails.name = document.getElementById('name').value;
            customerDetails.phone = document.getElementById('phone').value;
            customerDetails.email = document.getElementById('email').value;
            customerDetails.address = document.getElementById('address').value;
            customerDetails.pincode = document.getElementById('pincode').value;
            customerDetails.orderDate = new Date().toLocaleDateString('en-GB');

            document.getElementById('payment-total-display').textContent = document.getElementById('cart-total').textContent;
            document.getElementById('payment-section').classList.remove('hidden');
            document.getElementById('select-payment-btn').classList.add('hidden');
        }

        function selectPayment(mode) {
            document.getElementById('upi-details').classList.add('hidden');
            document.getElementById('card-details').classList.add('hidden');
            document.getElementById('payment-error').classList.add('hidden');
            
            document.getElementById(mode).checked = true;

            if (mode === 'upi') {
                document.getElementById('upi-details').classList.remove('hidden');
            } else if (mode === 'card') {
                document.getElementById('card-details').classList.remove('hidden');
            }
        }

        function generateUniqueOrderId() {
            const randomNum = Math.floor(100000 + Math.random() * 900000); 
            return `DPD-${randomNum}`;
        }

        function proceedToPay() {
            const selectedMode = document.querySelector('input[name="payment-mode"]:checked');
            if (!selectedMode) {
                document.getElementById('payment-error').textContent = 'Please select a payment mode.';
                document.getElementById('payment-error').classList.remove('hidden');
                return;
            }

            const mode = selectedMode.value;
            let paymentValid = true;
            let paymentInfo = `Mode: ${mode.toUpperCase()}`;
            
            if (mode === 'upi') {
                const upiId = document.getElementById('upi-id').value;
                if (!upiId) paymentValid = false;
                paymentInfo += `, ID: ${upiId}`;
            } else if (mode === 'card') {
                const cardNumber = document.getElementById('card-number').value;
                const expiry = document.getElementById('expiry').value;
                const cvv = document.getElementById('cvv').value;
                if (cardNumber.length !== 16 || expiry.length !== 5 || cvv.length < 3) paymentValid = false;
                paymentInfo += `, Card: **** **** **** ${cardNumber.slice(-4)}`;
            }

            if (!paymentValid && mode !== 'cod') {
                document.getElementById('payment-error').textContent = 'Please enter all required payment details correctly.';
                document.getElementById('payment-error').classList.remove('hidden');
                return;
            }

            customerDetails.finalCartSnapshot = JSON.parse(JSON.stringify(cart));
            customerDetails.paymentMode = paymentInfo;
            customerDetails.orderId = generateUniqueOrderId(); // Generate and store Order ID

            alert(`Payment of ${document.getElementById('cart-total').textContent} successful via ${mode.toUpperCase()}! Your order is confirmed. Order ID: ${customerDetails.orderId}`);
            
            generateInvoicePDF();
            
            cart = [];
            renderCart();
            document.getElementById('checkout-form').reset();
            
            showPage('home'); 
        }

         
        function generateInvoicePDF() {
            if (typeof window.jspdf === 'undefined') {
                 alert("Invoice library (jsPDF) failed to load. Please try again.");
                 return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const finalCart = customerDetails.finalCartSnapshot || [];
            if (finalCart.length === 0) {
                alert("Cannot generate invoice: Cart details were lost.");
                return;
            }
            
            const symbol = finalCart[0].symbol; 
            const total = finalCart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 15;
            let y = margin;
            const lineHeight = 6;
            
            const primaryBlue = '#0066cc'; 
            const goldAccent = '#ffaa00'; 
            const darkGrey = '#333333'; 
            const lightGreyText = '#777777'; 
            const lightFill = '#f5f7fa'; 
            
            const tableWidth = pageWidth - (2 * margin);
            const col1X = margin + 2; 
            const col4X = pageWidth - margin - 5; 
            const col3X = col4X - 30; 
            const col2X = col3X - 30; 
            
            
            doc.setFillColor(primaryBlue);
            doc.rect(0, 0, pageWidth, 25, 'F'); 
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(255, 255, 255); 
            doc.text("DPD JOURNALS", margin, 17);
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text("Driving Research, Inspiring Innovation", margin + 50, 17);
            
            y = 35; 

            const boxWidth = 70;
            const boxX = pageWidth - margin - boxWidth;
            
            doc.setFillColor(lightFill); 
            doc.rect(boxX, y, boxWidth, 34, 'F');
            doc.setDrawColor(primaryBlue); 
            doc.setLineWidth(0.5);
            doc.rect(boxX, y, boxWidth, 34, 'S'); 
            
            doc.setFontSize(10);
            doc.setTextColor(darkGrey); 
            doc.setFont('helvetica', 'bold');
            
            doc.text("ORDER ID:", boxX + 5, y + 5);
            doc.text(`DATE:`, boxX + 5, y + 13);
            doc.text(`INVOICE #`, boxX + 5, y + 21);
            doc.text(`CURRENCY:`, boxX + 5, y + 29); 

            doc.setFont('helvetica', 'normal');
            doc.text(`${customerDetails.orderId || 'N/A'}`, boxX + 30, y + 5); 
            doc.text(`${customerDetails.orderDate}`, boxX + 30, y + 13);
            doc.text(`${Math.floor(Math.random() * 1000000)}`, boxX + 30, y + 21);
            doc.text(`${symbol === '‚Çπ' ? 'INR' : symbol === '$' ? 'USD' : 'EUR'}`, boxX + 30, y + 29);
            
            y += 42; 

            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(primaryBlue);
            doc.text("Billed To:", margin, y);
            y += lineHeight;

            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(darkGrey); 
            doc.text(`Name: ${customerDetails.name}`, margin, y);
            doc.setTextColor(lightGreyText); 
            doc.text(`Email: ${customerDetails.email}`, margin + 80, y);
            y += lineHeight;
            doc.setTextColor(darkGrey); 
            doc.text(`Phone: ${customerDetails.phone}`, margin, y);
            doc.setTextColor(lightGreyText); 
            doc.text(`Pincode: ${customerDetails.pincode}`, margin + 80, y);
            y += lineHeight;
            doc.setTextColor(darkGrey); 
            doc.text(`Address: ${customerDetails.address}`, margin, y);
            y += lineHeight * 2;
            
            
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(darkGrey); 
            doc.text("Order Summary", margin, y);
            y += lineHeight;
            
            const tableY = y + 1;
            doc.setFillColor(primaryBlue);
            doc.rect(margin, tableY, tableWidth, lineHeight + 2, 'F');
            doc.setFontSize(10);
            doc.setTextColor(255, 255, 255); 
            
            doc.text("Product Name", col1X, tableY + 4);
            doc.text("Unit Price", col2X, tableY + 4, null, null, 'right');
            doc.text("Qty", col3X, tableY + 4, null, null, 'right');
            doc.text("Subtotal", col4X, tableY + 4, null, null, 'right');
            y += lineHeight + 5; 

            doc.setFont('helvetica', 'normal');
            doc.setTextColor(darkGrey); 
            
            finalCart.forEach((item, index) => {
                const subtotal = (item.price * item.quantity).toFixed(2);
                
                if (index % 2 !== 0) {
                    doc.setFillColor(lightFill); 
                    doc.rect(margin, y, tableWidth, lineHeight + 2, 'F');
                }
                
                doc.text(item.name, col1X, y + 4);
                
                doc.text(`${symbol}${item.price.toFixed(2)}`, col2X, y + 4, null, null, 'right');
                doc.text(`${item.quantity}`, col3X, y + 4, null, null, 'right');
                
                doc.setFont('helvetica', 'bold'); 
                doc.text(`${symbol}${subtotal}`, col4X, y + 4, null, null, 'right');
                doc.setFont('helvetica', 'normal'); 
                
                y += lineHeight + 2;
            });
            y += 5;

            
            doc.setDrawColor(primaryBlue); 
            doc.setLineWidth(0.5);
            
            const grandTotalLabelX = col4X - 55; 
            
            doc.line(grandTotalLabelX, y, col4X + 5, y); 
            y += lineHeight;

            
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(primaryBlue);
            
            doc.text("GRAND TOTAL:", grandTotalLabelX, y, null, null, 'left');
            
            doc.setTextColor(goldAccent); 
            doc.text(`${symbol}${total}`, col4X, y, null, null, 'right');
            y += lineHeight + 5;

            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(darkGrey);
            doc.text(`Payment Status: SUCCESS`, margin, y);
            y += lineHeight;
            doc.setTextColor(lightGreyText);
            doc.text(`Payment Method: ${customerDetails.paymentMode}`, margin, y);
            y += lineHeight * 2;
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(primaryBlue);
            doc.text("THANK YOU FOR YOUR BUSINESS!", pageWidth / 2, y, null, null, "center");

            doc.save(`DPD_Invoice_${customerDetails.orderId}.pdf`);
        }

        

        const FAKE_REVIEWS = [
            { name: "Anjali M.", rating: 5, text: "Outstanding selection of technical journals. The peer review quality is noticeably high. A must-have for serious researchers in CSE." },
            { name: "Dr. K. Sharma", rating: 5, text: "The new issue on Sustainable Energy Systems is highly insightful. Quick access and excellent print quality. Highly recommend DPD." },
            { name: "Raja S.", rating: 4, text: "Good variety, though the subscription cost for international locations is a bit steep. Content quality is top-notch." },
            { name: "Priya V.", rating: 5, text: "The Global Business Management journal provided crucial data for my thesis. Their online access system is very user-friendly." },
            { name: "Mike T.", rating: 3, text: "Solid content, but sometimes the delivery for physical copies is a bit slow. Digital access is fast and reliable, though." },
            { name: "Chen L.", rating: 4, text: "Very relevant articles in Nano-Technologies. I appreciate the clear structure and prompt communication from the editorial team." },
            { name: "Isabella R.", rating: 5, text: "Five stars for the DPD Review of Social Dynamics. Ground-breaking research and diverse perspectives. Excellent service overall." },
            { name: "Harsh S.", rating: 4, text: "Used the journal on Computational Science for a complex project. It was invaluable. The pricing change based on location is fair." },
            { name: "Fatima B.", rating: 5, text: "Seamless ordering process and immediate digital delivery. The team is very professional. A true leader in academic publishing." },
            { name: "David P.", rating: 4, text: "High quality papers, especially the special issues. The quantity limit of 10 is reasonable for individual researchers." }
        ];

        function renderReviews() {
            const reviewsContainer = document.getElementById('existing-reviews');
            reviewsContainer.innerHTML = '<h3 style="color: var(--primary-color);">What Our Readers Say:</h3>';
            
            FAKE_REVIEWS.forEach(review => {
                const starRating = '‚≠ê'.repeat(review.rating);
                const reviewHTML = `
                    <div class="review-card">
                        <p><strong>${review.name}</strong> | <span class="rating">${starRating}</span></p>
                        <p style="color: var(--dark-text); margin-top: 10px;">"${review.text}"</p>
                    </div>
                `;
                reviewsContainer.insertAdjacentHTML('beforeend', reviewHTML);
            });
        }

        function handleNewReview(e) {
            e.preventDefault();
            const name = document.getElementById('review-name').value;
            const rating = document.getElementById('review-rating').value;
            const text = document.getElementById('review-text').value;
            const messageElement = document.getElementById('review-message');

            if (!name || !rating || !text) {
                messageElement.textContent = 'Please fill out all fields.';
                messageElement.classList.remove('hidden');
                return;
            }

            const newReview = { name, rating: parseInt(rating), text };
            FAKE_REVIEWS.unshift(newReview);
            renderReviews();

            document.getElementById('new-review-form').reset();
            messageElement.textContent = 'Thank you! Your review has been submitted successfully (Dummy Posting).';
            messageElement.style.color = 'var(--success-color)';
            messageElement.classList.remove('hidden');

            setTimeout(() => {
                messageElement.classList.add('hidden');
                messageElement.style.color = 'var(--danger-color)';
            }, 5000);
        }

        
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts();
            renderCart();
            renderReviews();

            document.getElementById('checkout-form').addEventListener('submit', handleCheckoutSubmit);
            document.getElementById('new-review-form').addEventListener('submit', handleNewReview);

            const initialPage = window.location.hash.substring(1) || 'home';
            showPage(initialPage.replace('-page', '')); 
        });

    </script>

</body>
</html>